import{j as e,w as V,I as L,r as i,y as _,a6 as F,p as P,am as U,B as G,o as W}from"./index-GbOaGgM0.js";import{C as z}from"./config-global-BwHnWRtc.js";import{p as A,E as p,g as E}from"./apiClient-i189rV0m.js";import{D as q}from"./content-OnO3XI0R.js";import{X}from"./index.es-CeEWRC6t.js";import{S as M}from"./Switch-cjtFEHns.js";import{S as N}from"./Stack-C7Qc0-kq.js";import{T as c}from"./TextField-BrPYWE6M.js";import{D as H,a as $,b as J}from"./DialogContent-lvUHi1mO.js";import{F as K}from"./FormControlLabel-DJ67-KM1.js";import{D as Q}from"./DialogActions-DbEpsrDh.js";import"./SwitchBase-CT3IaKnp.js";import"./Select-BaJTgM_p.js";function Z({rows:g,page:d,total:s,onPageChange:h,onReload:y,onEdit:a}){const r=[{name:"Title",selector:l=>l.title,sortable:!0},{name:"City",selector:l=>{var o;return((o=l.location)==null?void 0:o.city)||"-"}},{name:"Category",selector:l=>{var o;return((o=l.category)==null?void 0:o.name)||"-"}},{name:"Featured",cell:l=>e.jsx(M,{checked:l.isFeatured,onChange:async o=>{await A(p.EDIT_EVENT(l._id),{isFeatured:o.target.checked},{authRequired:!0}),y()}})},{name:"Action",cell:l=>e.jsx(V,{onClick:()=>a(l),children:e.jsx(L,{icon:"solar:pen-bold"})})}];return e.jsx(X,{columns:r,data:g,pagination:!0,paginationServer:!0,paginationTotalRows:s,paginationPerPage:10,paginationDefaultPage:d,onChangePage:h,highlightOnHover:!0,responsive:!0})}function ee({search:g,city:d,category:s,onSearch:h,onCity:y,onCategory:a}){const[r,l]=i.useState([]),[o,C]=i.useState([]);return i.useEffect(()=>{E(p.GET_CITY).then(n=>l(n.data.data||[])),E(p.GET_CATEGORY).then(n=>C(n.data.category||[]))},[]),e.jsxs(N,{direction:"row",spacing:2,sx:{width:"100%"},children:[e.jsx(c,{fullWidth:!0,size:"small",placeholder:"Search event",value:g,onChange:n=>h(n.target.value)}),e.jsxs(c,{select:!0,fullWidth:!0,size:"small",label:"City",value:d,onChange:n=>y(n.target.value),children:[e.jsx(_,{value:"",children:"All Cities"}),r.map(n=>e.jsx(_,{value:n._id,children:n.city},n._id))]}),e.jsxs(c,{select:!0,fullWidth:!0,size:"small",label:"Category",value:s,onChange:n=>a(n.target.value),children:[e.jsx(_,{value:"",children:"All Categories"}),o.map(n=>e.jsx(_,{value:n._id,children:n.name},n._id))]})]})}const O={title:"",description:"",image:null,location:"",ticket_price:"",category:"",sub_category:"",address:"",eventMode:"offline",visibility:!0,start_date:"",end_date:"",start_time:"",end_time:""};function te({open:g,mode:d,event:s,onClose:h,onSuccess:y}){const[a,r]=i.useState(O),[l,o]=i.useState(null),[C,n]=i.useState([]),[I,v]=i.useState([]),[k,S]=i.useState([]),[T,j]=i.useState(!1),[w,x]=i.useState(""),[f,R]=i.useState(""),Y="http://172.93.223.239:3001";i.useEffect(()=>{E(p.GET_CITY).then(t=>n(t.data.data||[])),E(p.GET_CATEGORY).then(t=>v(t.data.category||[]))},[]),i.useEffect(()=>{a.category&&E(p.GET_SUBCATEGORY_BY_CATEGORY(a.category)).then(t=>S(t.data.subCategories||[]))},[a.category]),i.useEffect(()=>{var t,m,u,D,b;g&&(x(""),R(""),d==="edit"&&s?(r({title:s.title||"",description:s.description||"",image:null,location:typeof s.location=="string"?s.location:((t=s.location)==null?void 0:t._id)||"",ticket_price:s.ticket_price||"",category:typeof s.category=="string"?s.category:((m=s.category)==null?void 0:m._id)||"",sub_category:typeof s.sub_category=="string"?s.sub_category:((u=s.sub_category)==null?void 0:u._id)||"",address:s.address||"",eventMode:s.eventMode||"offline",visibility:s.visibility??!0,start_date:((D=s.start_date)==null?void 0:D.substring(0,10))||"",end_date:((b=s.end_date)==null?void 0:b.substring(0,10))||"",start_time:s.start_time||"",end_time:s.end_time||""}),o(s.image?Y+s.image:null)):(r(O),o(null)))},[g,d,s]);const B=async()=>{var t,m;try{j(!0),x("");const u=new FormData;Object.entries(a).forEach(([D,b])=>{b!==null&&b!==""&&u.append(D,b)}),d==="create"?(await A(p.ADD_EVENT,u,{authRequired:!0,headers:{"Content-Type":"multipart/form-data"}}),R("Event created successfully")):(await A(p.EDIT_EVENT(s._id),u,{authRequired:!0,headers:{"Content-Type":"multipart/form-data"}}),R("Event updated successfully")),y(),setTimeout(h,700)}catch(u){x(((m=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:m.message)||"Something went wrong")}finally{j(!1)}};return e.jsxs(H,{open:g,onClose:h,maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:d==="create"?"Create Event":"Edit Event"}),e.jsx(J,{children:e.jsxs(N,{spacing:2,mt:1,children:[w&&e.jsx(F,{severity:"error",children:w}),f&&e.jsx(F,{severity:"success",children:f}),e.jsx(c,{label:"Title",value:a.title,onChange:t=>r({...a,title:t.target.value})}),e.jsx(c,{label:"Description",multiline:!0,rows:3,value:a.description,onChange:t=>r({...a,description:t.target.value})}),e.jsxs(P,{component:"label",variant:"outlined",children:["Upload Image",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>{var u;const m=(u=t.target.files)==null?void 0:u[0];m&&(r({...a,image:m}),o(URL.createObjectURL(m)))}})]}),l&&e.jsx("img",{src:l,style:{width:"100%",height:180,objectFit:"cover",borderRadius:10}}),e.jsx(c,{select:!0,label:"City",value:a.location,onChange:t=>r({...a,location:t.target.value}),children:C.map(t=>e.jsx(_,{value:t._id,children:t.city},t._id))}),e.jsx(c,{select:!0,label:"Category",value:a.category,onChange:t=>r({...a,category:t.target.value,sub_category:""}),children:I.map(t=>e.jsx(_,{value:t._id,children:t.name},t._id))}),e.jsx(c,{select:!0,label:"Sub Category",value:a.sub_category,disabled:!k.length,onChange:t=>r({...a,sub_category:t.target.value}),children:k.map(t=>e.jsx(_,{value:t._id,children:t.name},t._id))}),e.jsx(c,{label:"Ticket Price",value:a.ticket_price,onChange:t=>r({...a,ticket_price:t.target.value})}),e.jsx(c,{label:"Address",value:a.address,onChange:t=>r({...a,address:t.target.value})}),e.jsx(K,{control:e.jsx(M,{checked:a.visibility,onChange:t=>r({...a,visibility:t.target.checked})}),label:"Visible"}),e.jsx(c,{type:"date",label:"Start Date",InputLabelProps:{shrink:!0},value:a.start_date,onChange:t=>r({...a,start_date:t.target.value})}),e.jsx(c,{type:"date",label:"End Date",InputLabelProps:{shrink:!0},value:a.end_date,onChange:t=>r({...a,end_date:t.target.value})}),e.jsx(c,{type:"time",label:"Start Time",InputLabelProps:{shrink:!0},value:a.start_time,onChange:t=>r({...a,start_time:t.target.value})}),e.jsx(c,{type:"time",label:"End Time",InputLabelProps:{shrink:!0},value:a.end_time,onChange:t=>r({...a,end_time:t.target.value})})]})}),e.jsxs(Q,{children:[e.jsx(P,{onClick:h,children:"Cancel"}),e.jsx(P,{variant:"contained",onClick:B,disabled:T,startIcon:T?e.jsx(U,{size:18,color:"inherit"}):null,children:T?"Saving...":"Save"})]})]})}function ae(){const[g,d]=i.useState([]),[s,h]=i.useState(1),[y,a]=i.useState(0),[r,l]=i.useState(!1),[o,C]=i.useState("create"),[n,I]=i.useState(null),[v,k]=i.useState(""),[S,T]=i.useState(""),[j,w]=i.useState(""),x=async()=>{const f=await E(p.GET_EVENTS,{params:{page:s,limit:10,search:v,cityId:S,category:j}});d(f.data.events),a(f.data.pagination.totalRecords)};return i.useEffect(()=>{x()},[s,v,S,j]),e.jsxs(q,{children:[e.jsxs(G,{sx:{mb:3,display:"flex",alignItems:"center"},children:[e.jsx(W,{variant:"h4",sx:{flexGrow:1},children:"Events"}),e.jsx(P,{variant:"contained",color:"inherit",startIcon:e.jsx(L,{icon:"mingcute:add-line"}),onClick:()=>{C("create"),I(null),l(!0)},children:"Create Event"})]}),e.jsx(ee,{search:v,city:S,category:j,onSearch:k,onCity:T,onCategory:w}),e.jsx(G,{sx:{mt:3},children:e.jsx(Z,{rows:g,page:s,total:y,onPageChange:h,onReload:x,onEdit:f=>{C("edit"),I(f),l(!0)}})}),e.jsx(te,{open:r,mode:o,event:n,onClose:()=>l(!1),onSuccess:x})]})}function ye(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Events - ${z.appName}`}),e.jsx(ae,{})]})}export{ye as default};
