import{r as i,j as e,p as u,B as m,o,A as z,y as B,am as L}from"./index-GbOaGgM0.js";import{C as $}from"./config-global-BwHnWRtc.js";import{p as w,E as p,g as v}from"./apiClient-i189rV0m.js";import{D as Y,a as q,b as V}from"./DialogContent-lvUHi1mO.js";import{S as J}from"./Stack-C7Qc0-kq.js";import{T as j}from"./TextField-BrPYWE6M.js";import{C as O}from"./Card-yMHnxVoN.js";import{C as H}from"./Chip-DLB2M0Hz.js";import"./Select-BaJTgM_p.js";function K({open:t,onClose:s,reload:g}){const[b,n]=i.useState("");return e.jsxs(Y,{open:t,onClose:s,children:[e.jsx(q,{children:"Sign MOU"}),e.jsx(V,{children:e.jsxs(J,{spacing:2,mt:2,children:[e.jsx(u,{variant:"outlined",onClick:()=>w(p.SEND_MOU_OTP),children:"Send OTP"}),e.jsx(j,{label:"Enter OTP",value:b,onChange:x=>n(x.target.value)}),e.jsx(u,{variant:"contained",onClick:async()=>{await w(p.VERIFY_MOU_OTP,{otp:b}),g(),s()},children:"Verify & Sign"})]})})]})}const Q="http://172.93.223.239:3001",k=({spacing:t=3,children:s})=>e.jsx(m,{sx:{display:"flex",flexWrap:"wrap",margin:`-${t*4}px`},children:s}),l=({xs:t=12,md:s,children:g})=>e.jsx(m,{sx:{padding:`${3*4}px`,width:{xs:`${t/12*100}%`,md:s?`${s/12*100}%`:void 0}},children:g});function X(){const t=(()=>{const a=localStorage.getItem("user");return a?JSON.parse(a):null})(),s=(t==null?void 0:t.roleId)===3,[g,b]=i.useState([]),[n,x]=i.useState({name:"",phone:"",location:"",password:""}),[d,y]=i.useState(null),[P,F]=i.useState(!0),[_,A]=i.useState(null),[I,W]=i.useState(null),[S,C]=i.useState({image:null,banner:null}),[R,E]=i.useState(!1),[G,U]=i.useState(!1);i.useEffect(()=>{if(!(t!=null&&t._id))return;(async()=>{var D;const r=[v(p.GET_PROFILE(t._id)),v(p.GET_CITY)];s&&r.push(v(p.GET_MY_MOU,{authRequired:!0}));const[c,f,T]=await Promise.all(r),h=c.data.profile;b(f.data.data),x({name:h.name||"",phone:h.phone?String(h.phone):"",location:((D=h.location)==null?void 0:D._id)||"",password:""}),C({image:h.image||null,banner:h.bannerImage||null}),s&&T&&(y(T.data.data),F(!1))})()},[t==null?void 0:t._id]);const N=async()=>{try{E(!0);const a=new FormData;a.append("name",n.name),a.append("phone",n.phone),a.append("password",n.password),a.append("location",n.location),_&&a.append("image",_),I&&a.append("bannerImage",I),await w(p.EDIT_PROFILE,a,{authRequired:!0}),alert("Profile updated successfully")}finally{E(!1)}},M=a=>{if(a)return a.startsWith("blob:")?a:Q+a};return e.jsxs(m,{sx:{px:4,pb:6,maxWidth:1200,mx:"auto"},children:[e.jsx(o,{variant:"h4",mb:4,children:"Profile Settings"}),e.jsxs(O,{sx:{borderRadius:6,mb:6,overflow:"hidden"},children:[e.jsx(m,{sx:{width:"100%",aspectRatio:"12 / 5",backgroundImage:S.banner?`url(${M(S.banner)})`:"linear-gradient(135deg,#4f46e5,#3b82f6)",backgroundSize:"cover",backgroundPosition:"center",position:"relative"},children:e.jsxs(u,{component:"label",size:"small",variant:"contained",sx:{position:"absolute",top:20,right:20},children:["Change Banner",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:a=>{var c;const r=(c=a.target.files)==null?void 0:c[0];r&&(W(r),C(f=>({...f,banner:URL.createObjectURL(r)})))}})]})}),e.jsxs(m,{sx:{px:4,py:3,display:"flex",gap:3,alignItems:"center",backgroundColor:"#fff"},children:[e.jsx(z,{src:M(S.image),sx:{width:150,height:150,border:"6px solid white"}}),e.jsxs(m,{children:[e.jsx(o,{variant:"h6",children:n.name||"Your Name"}),e.jsx(o,{variant:"body2",color:"text.secondary",mb:1,children:"Profile picture"}),e.jsxs(u,{component:"label",size:"small",variant:"outlined",children:["Change Avatar",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:a=>{var c;const r=(c=a.target.files)==null?void 0:c[0];r&&(A(r),C(f=>({...f,image:URL.createObjectURL(r)})))}})]})]})]})]}),e.jsxs(O,{sx:{p:5,borderRadius:6,maxWidth:900},children:[e.jsx(o,{variant:"h6",mb:1,children:"Account Information"}),e.jsx(o,{variant:"body2",color:"text.secondary",mb:4,children:"Update your personal details"}),e.jsxs(k,{spacing:3,children:[e.jsx(l,{xs:12,children:e.jsx(j,{fullWidth:!0,label:"Full Name",value:n.name,onChange:a=>x({...n,name:a.target.value})})}),e.jsx(l,{xs:12,md:6,children:e.jsx(j,{fullWidth:!0,label:"Phone",value:n.phone,disabled:!0})}),e.jsx(l,{xs:12,md:6,children:e.jsx(j,{select:!0,fullWidth:!0,label:"City",value:n.location,onChange:a=>x({...n,location:a.target.value}),children:g.map(a=>e.jsx(B,{value:a._id,children:a.city},a._id))})}),e.jsx(l,{xs:12,children:e.jsx(j,{fullWidth:!0,label:"Password",value:n.password,onChange:a=>x({...n,password:a.target.value})})}),e.jsx(l,{xs:12,children:e.jsx(u,{size:"large",variant:"contained",disabled:R,onClick:N,startIcon:R?e.jsx(L,{size:18}):null,children:"Save Changes"})})]})]}),s&&e.jsxs(O,{sx:{p:5,borderRadius:6,maxWidth:900,mt:6},children:[e.jsx(o,{variant:"h6",mb:1,children:"Memorandum of Understanding (MOU)"}),P&&e.jsx(L,{}),!P&&d&&e.jsxs(k,{spacing:3,children:[e.jsxs(l,{xs:12,md:6,children:[e.jsx(o,{variant:"subtitle2",children:"Status"}),e.jsx(H,{label:d.status})]}),e.jsxs(l,{xs:12,md:6,children:[e.jsx(o,{variant:"subtitle2",children:"Signed At"}),e.jsx(o,{children:d.signedAt?new Date(d.signedAt).toLocaleDateString():"-"})]}),d.pdfUrl&&e.jsx(l,{xs:12,children:e.jsx(u,{variant:"outlined",href:d.pdfUrl,target:"_blank",children:"View MOU PDF"})}),d.status!=="signed"&&e.jsx(l,{xs:12,children:e.jsx(u,{variant:"contained",onClick:()=>U(!0),children:"Sign MOU"})})]})]}),e.jsx(K,{open:G,onClose:()=>U(!1),reload:async()=>{const a=await v(p.GET_MY_MOU,{authRequired:!0});y(a.data.data)}})]})}function le(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Profile - ${$.appName}`}),e.jsx(X,{})]})}export{le as default};
